<!DOCTYPE html>
<html lang="en" manifest="cache.manifest">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Klondike Guide">
    <title>Klondike Highway Narrator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(to bottom, #1e3a8a, #1e40af); min-height: 100vh; padding: 16px 16px 200px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 16px; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 28px; color: #1f2937; }
        .header p { color: #6b7280; margin-top: 4px; }
        .header-icon { font-size: 48px; }
        .subtitle { color: #6b7280; font-size: 14px; margin-top: 12px; }
        .gps-section { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 16px; margin-bottom: 16px; }
        .gps-button { width: 100%; background: #10b981; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .gps-button:active { background: #059669; }
        .gps-button.active { background: #3b82f6; }
        .gps-button.disabled { background: #9ca3af; cursor: not-allowed; }
        .gps-status { margin-top: 12px; font-size: 14px; color: #6b7280; text-align: center; }
        .location-info { background: #eff6ff; padding: 8px 12px; border-radius: 6px; margin-top: 8px; font-size: 13px; color: #1e40af; }
        .mile-list { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 16px; }
        .mile-scroll { max-height: 500px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .mile-item { padding: 16px; border-bottom: 1px solid #e5e7eb; cursor: pointer; transition: background-color 0.2s; display: flex; gap: 16px; align-items: flex-start; position: relative; }
        .mile-item:hover { background-color: #eff6ff; }
        .mile-item.active { background-color: #dbeafe; }
        .mile-item.nearest { background-color: #fef3c7; border-left: 4px solid #f59e0b; }
        .mile-item.nearby { background-color: #f0fdf4; }
        .distance-badge { position: absolute; top: 12px; right: 12px; background: #3b82f6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; pointer-events: none; z-index: 10; }
        .distance-badge.nearest { background: #f59e0b; }
        .distance-badge.nearby { background: #10b981; }
        .mile-icon { font-size: 36px; flex-shrink: 0; margin-top: 4px; }
        .mile-content { flex: 1; min-width: 0; padding-right: 70px; }
        .mile-header { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 4px; }
        .mile-badge { background: #2563eb; color: white; padding: 4px 12px; border-radius: 9999px; font-size: 14px; font-weight: bold; }
        .mile-km { color: #6b7280; font-size: 14px; }
        .mile-title { font-weight: 600; font-size: 18px; color: #1f2937; margin-bottom: 4px; }
        .mile-text { color: #4b5563; font-size: 14px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .mile-play { flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
        .play-icon { width: 32px; height: 32px; color: #2563eb; }
        .play-indicator { width: 40px; height: 40px; background: #2563eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .pulse { width: 12px; height: 12px; background: white; border-radius: 50%; animation: pulse 1.5s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .footer { text-align: center; color: white; font-size: 14px; opacity: 0.75; margin-top: 16px; }
        .controls { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 2px solid #e5e7eb; box-shadow: 0 -4px 6px rgba(0,0,0,0.1); z-index: 1000; display: none; }
        .controls.active { display: block; }
        .controls-inner { max-width: 800px; margin: 0 auto; padding: 16px; }
        .progress-container { margin-bottom: 16px; }
        .progress-bar { width: 100%; height: 10px; background: #e5e7eb; border-radius: 9999px; overflow: hidden; }
        .progress-fill { height: 100%; background: #2563eb; transition: width 0.1s linear; }
        .progress-text { display: flex; justify-content: space-between; font-size: 12px; color: #6b7280; margin-top: 6px; }
        .progress-status { font-weight: 500; }
        .now-playing { margin-bottom: 12px; }
        .now-playing-label { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
        .now-playing-title { font-weight: 600; color: #1f2937; font-size: 16px; }
        .now-playing-mile { font-size: 14px; color: #4b5563; }
        .playback-controls { display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 12px; }
        .control-btn { background: #f3f4f6; border: none; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background-color 0.2s; }
        .control-btn:active { background: #e5e7eb; }
        .control-btn.primary { background: #2563eb; width: 56px; height: 56px; }
        .control-btn.primary:active { background: #1d4ed8; }
        .control-btn.stop { background: #ef4444; }
        .control-btn.stop:active { background: #dc2626; }
        .speed-control { border-top: 1px solid #e5e7eb; padding-top: 12px; }
        .speed-btn, .voice-btn { display: flex; align-items: center; justify-content: center; gap: 8px; background: none; border: none; color: #4b5563; font-size: 14px; cursor: pointer; margin: 0 auto 8px; padding: 8px; }
        .speed-slider, .voice-selector { display: none; margin-top: 12px; padding: 0 16px; }
        .speed-slider.active, .voice-selector.active { display: block; }
        .slider { width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none; -webkit-appearance: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #2563eb; cursor: pointer; }
        .slider::-moz-range-thumb { width: 20px; height: 20px; border-radius: 50%; background: #2563eb; cursor: pointer; border: none; }
        .speed-labels { display: flex; justify-content: space-between; font-size: 12px; color: #6b7280; margin-top: 4px; }
        .voice-select { width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px; background: white; }
        .voice-quality { font-size: 11px; color: #6b7280; margin-top: 4px; }
        svg { width: 24px; height: 24px; }
        .primary svg { width: 32px; height: 32px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div><h1>Klondike Highway</h1><p>Audio Tour Guide</p></div>
                <div class="header-icon">üîä</div>
            </div>
            <p class="subtitle">GPS-enabled narration for your journey</p>
        </div>

        <div class="gps-section">
            <button class="gps-button" id="gpsBtn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span id="gpsText">Enable GPS Location</span>
            </button>
            <div class="gps-status" id="gpsStatus"></div>
        </div>

        <div class="mile-list"><div class="mile-scroll" id="mileList"></div></div>

        <div class="footer">
            <p>Murray's Guide to the South Klondike Highway</p>
            <p style="font-size: 12px; margin-top: 4px;">¬© Murray Lundberg</p>
        </div>
    </div>

    <div class="controls" id="controls">
        <div class="controls-inner">
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                <div class="progress-text">
                    <span id="progressPercent">0%</span>
                    <span class="progress-status" id="progressStatus">Playing</span>
                </div>
            </div>
            <div class="now-playing">
                <div class="now-playing-label">NOW PLAYING</div>
                <div class="now-playing-title" id="nowPlayingTitle"></div>
                <div class="now-playing-mile" id="nowPlayingMile"></div>
            </div>
            <div class="playback-controls">
                <button class="control-btn" id="skipBackBtn" title="Rewind 5 seconds">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0019 16V8a1 1 0 00-1.6-.8l-5.333 4zM4.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0011 16V8a1 1 0 00-1.6-.8l-5.334 4z"/></svg>
                </button>
                <button class="control-btn primary" id="pauseBtn" title="Pause">
                    <svg fill="none" stroke="white" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"/></svg>
                </button>
                <button class="control-btn" id="skipForwardBtn" title="Skip forward 5 seconds">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z"/></svg>
                </button>
                <button class="control-btn stop" id="stopBtn" title="Stop">
                    <svg fill="white" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                </button>
            </div>
            <div class="speed-control">
                <button class="voice-btn" id="voiceBtn">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>
                    <span>Voice: <span id="voiceName">Default</span></span>
                </button>
                <div class="voice-selector" id="voiceSelector">
                    <select class="voice-select" id="voiceSelect"></select>
                    <div class="voice-quality">üí° Tip: Voices with "Enhanced" or "Premium" sound more natural</div>
                </div>
                <button class="speed-btn" id="speedBtn">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    <span>Speed: <span id="speedValue">0.9</span>x</span>
                </button>
                <div class="speed-slider" id="speedSlider">
                    <input type="range" min="0.5" max="2" step="0.1" value="0.9" class="slider" id="speedRange">
                    <div class="speed-labels"><span>0.5x</span><span>1.0x</span><span>2.0x</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
// Mile marker data with GPS coordinates and FULL text from PDF
var mileData=[
{m:"0",k:"0",t:"Skagway Ferry Dock",x:"The Skagway ferry dock. To get through town, you can either go up Broadway through the historic district, or if its busy, turn left at the first stores, go one block and then right at the sign seen on page 1 of this Guide, which is State Street. There is ample parking along State Street so you can explore the shops and historic sites in town, and take one of the free walking tours conducted by the National Park Service. One of the 2 gas stations in town is on the right as soon as you make this turn at State and 2nd. There is also a small convenience store and self-serve laundry there. The grocery store is another 2 blocks up on State Street, on the left, and the other gas station is 1 block to the left at 4th and Main. Watch your speed very carefully in Skagway, the police do. Its 25 mph to the bridge across the Skagway River, then 35 mph to the start of the climb up the White Pass.",i:"üö¢",lat:59.4581,lon:-135.3239},
{m:"0.2",k:"0.4",t:"Centennial Park",x:"Centennial Park, with Rotary snow plow number 1, a sculpture of Chilkoot packers by the late Chuck Buchanan of Carcross and other attractions. The view up Broadway, Skagways main street, from in front of Centennial Park. The red building to the right is the National Park Service headquarters. The White Pass and Yukon Route railway station is immediately to the right of the NPS building, while people who book train trips on their ships board the trains right at their ships, independents board at this station. The NPS Chilkoot Trail office is the small light-blue building on the left side of Broadway. The second building past that is the Red Onion Saloon, another popular stop for visitors. The golden dome is the historic Golden North Hotel, now used as a residence for seasonal workers.",i:"üóø",lat:59.4593,lon:-135.3229},
{m:"1.6",k:"2.6",t:"Railway Maintenance Shops",x:"White Pass and Yukon Route railway maintenance shops. Historically, the railway ran 112 miles to Whitehorse, Yukon, but now trains only go as far as Carcross 67 miles and Lake Bennett 41 miles regularly. A great deal more information about the WP and YR can be seen at RailsNorth.com. No tours through the shops are being offered this year.",i:"üöÇ",lat:59.4652,lon:-135.3156},
{m:"1.7",k:"2.7",t:"Pioneer Cemetery Road",x:"The gravel road to the right takes you 0.6 mile or 1 kilometer to the Pioneer Cemetery, final resting place of people such as Soapy Smith and Frank Reid, famous for the gunfight that saved Skagway. Gold Rush Cemetery, a 30-page guide by Glenda Choate, can be bought at the Skagway News office on Broadway between 2nd and 3rd Avenues. A short trail starting at the upper northern end of the cemetery leads to Lower Reid Falls, a popular spot for walkers and photographers.",i:"‚õ∞Ô∏è",lat:59.4659,lon:-135.3149},
{m:"1.9",k:"3.1",t:"Klondike Gold Dredge",x:"On the right is the historic Klondike Gold Dredge, moved to Skagway from the Fortymile Mining District near Dawson City over the winter of 1999 to 2000. Skagway was never a placer gold mining area, but the dredge offers a good look at how it was done in other places.",i:"‚öôÔ∏è",lat:59.4672,lon:-135.3134},
{m:"2.4",k:"3.9",t:"Dyea Road Junction",x:"The paved road to the left is the Dyea Road, leading first to this very scenic viewpoint over Skagway. Those on a cruise ship will be able to see their ship from here. There is ample room here to U-turn even large RVs and highway motorcoaches, though parking is very limited. A small expedition-type cruise ship and a State ferry are seen in this photo. The Dyea Road then continues another 6.5 miles as a narrow, winding gravel road to the Klondike Gold Rush ghost town of Dyea. Due to the road width and a low bridge, this road is not recommended for large RVs. No structures remain at Dyea, the cemeteries and scenery are the main historic attraction now.",i:"üèîÔ∏è",lat:59.4712,lon:-135.3089},
{m:"2.8",k:"4.5",t:"Highway Gate",x:"This gate is used to close the highway when necessary because of avalanches or rock slides. In a normal winter the highway is closed for 4 or 5 days total.",i:"üöß",lat:59.4751,lon:-135.3045},
{m:"3.0",k:"4.8",t:"Liarsville",x:"The gravel road to the right goes to Liarsville, a replica gold camp, tours that visit Liarsville are available but no independent visits are permitted. The name comes from the fact that many reporters who claimed to be going to the Klondike gold fields got their stories from returning prospectors at the tent camp that was here. From this point the highway climbs steeply for 12 miles to the summit, except for a short nearly-level stretch at the Black Lakes at Mile 4.4. The speed limit is now 40 mph.",i:"‚õ∫",lat:59.4789,lon:-135.3001},
{m:"4.4",k:"7.1",t:"Black Lakes",x:"Black Lakes. The original pack trail also went through this narrow gorge.",i:"üåä",lat:59.4923,lon:-135.2812},
{m:"5.0",k:"8.0",t:"Rocky Point Viewpoint",x:"Large paved pullout with a view of Rocky Point on the opposite side of the gorge, and an impressive view up the East Fork of the Skagway River. Rocky Point was one of the main trouble spots when a route for a railroad was being searched for in 1898, and engineers almost gave up on building the railroad because of it. Mountain goats are occasionally seen on the cliffs of Rocky Point at about the same elevation as the highway. Its worth watching for mountain goats on the cliffs along the highway right up to the summit, particularly in May and June and then again in September.",i:"üêê",lat:59.5123,lon:-135.2567},
{m:"5.5",k:"8.8",t:"Brackett Wagon Road",x:"Paved pull-off, from where sections of the Brackett Wagon Road, built as a toll road at the start of the Klondike Gold Rush by George Brackett, former mayor of Minneapolis, can still be seen below the railway grade. The Brackett Road is in the center of this photo. There are interpretive panels here about the Brackett Road and the WP and YR railway. While the Brackett Road was first, the railway won the battle for traffic, the fact that when blasting was done on the railway grade, the rocks fell and blocked the Brackett Road may have helped!",i:"üõ§Ô∏è",lat:59.5234,lon:-135.2389},
{m:"6.2",k:"10.0",t:"Zipline Operation",x:"The small parking lot on the left is for a private zipline and rock climbing operation run by Alaska Mountain Guides, tours are only available from the cruise ships.",i:"üßó",lat:59.5312,lon:-135.2245},
{m:"6.8",k:"10.9",t:"US Customs",x:"The U.S. Customs post, located at Mile 6.8, can be seen in the distance in this photo taken from Mile 5.5. The nearer building is Skagways incinerator. All southbound vehicles heading into Skagway must stop and report at the Customs post, this is a very efficient post and delays of more than 10 minutes are uncommon. Note that US Customs is 8.1 miles south of the actual border and Canada Customs is 6.4 miles north of the border. The reason is that the weather in the summit area is too severe to make having Customs posts there reasonable. There are many turnouts of all sizes suitable for photo stops between this point and the summit.",i:"üõÇ",lat:59.5389,lon:-135.2134},
{m:"7.7",k:"12.4",t:"Pitchfork Falls",x:"Turnout with a great view of Pitchfork Falls, which flows out of Goat Lake. This is one of the most photographed falls in Alaska, but the construction of a hydro-electric operation in 1999 has led to it being known by many locals as Pipeline Falls. Nobody complains about the huge reduction in electricity costs that resulted, though!",i:"üíß",lat:59.5512,lon:-135.1923},
{m:"9.1",k:"14.6",t:"White Pass City",x:"Interpretive panels about White Pass City on the Klondike gold trail, and the infamous Deadhorse Trail.",i:"üìú",lat:59.5689,lon:-135.1678},
{m:"9.8",k:"15.8",t:"Runaway Lane",x:"On the left is a runaway lane, for emergency use by vehicles which burn out their brakes coming down this long grade. DO NOT park near any of these runaway lanes, they do get occasional use!",i:"‚ö†Ô∏è",lat:59.5756,lon:-135.1589},
{m:"10.0",k:"16.1",t:"Bridal Veil Falls",x:"On the left is a particularly nice and accessible waterfall with a large paved parking area. The water is pure enough to drink. Its usually called Bridal Veil Falls, but Narrators on the White Pass and Yukon Route railway use that name for a much larger waterfall on the same creek but below the highway. The railway line can be seen far across the valley, at one point running across a large bare granite patch known as Slippery Rock, where men suspended by ropes blasted out a shelf from the mountainside. Just to the left of Slippery Rock is the most-photographed section of the rail line, as it goes into a tunnel through Tunnel Mountain. This is where the highway leaves the gold rush route for a few miles. The railway climbs up to the White Pass, which is the historic route, for both rail and foot travellers. The highway climbs to an un-named pass which was not used by the gold rush stampeders, as access was much more difficult than the White Pass.",i:"üåä",lat:59.5834,lon:-135.1456},
{m:"11.0",k:"17.9",t:"William Moore Bridge",x:"The viewing area is just before you reach the bridges. The photo above, looking back towards Skagway from the north side, shows the old William Moore Bridge on the left and the new one on the right, as construction was nearing completion. The old one, built in 1976, is an asymmetrical cable-stayed suspension bridge that crosses a very active earthquake fault. It is only firmly anchored on the downhill side so that it can move freely with the earth! The gorge that the bridge crosses is only 110 feet wide, but 180 feet deep, the bridge deck is about 250 feet long. On May 17, 2017, work began on a new crossing, starting with extensive blasting, it is opened in September 2019, and the old bridge will become a historic site managed by the National Park Service, though the process of opening it to foot traffic is still underway.",i:"üåâ",lat:59.5978,lon:-135.1234},
{m:"11.6",k:"18.7",t:"Valley Viewpoint",x:"Two large paved parking areas with excellent views down the Skagway River Valley, with the Cleveland Glacier above the Moore Bridge and the Sawtooth Mountains to the left. There are 2 interpretive panels here, about the construction of the highway, and the valley as a natural migration route. The diamond-drill holes on the cliffs opposite this parking area give you some idea of the amount of blasting that was required to build this road. The rock has many fractures, and breaking drill bits when they hit these fractures was a big problem.",i:"üèîÔ∏è",lat:59.6045,lon:-135.1123},
{m:"12.0",k:"19.3",t:"Maintenance Sheds",x:"Runaway lane to the left, with highway maintenance equipment sheds just beyond.",i:"üèóÔ∏è",lat:59.6123,lon:-135.0989},
{m:"13.0",k:"20.9",t:"White Pass Gorge",x:"A gravel pullout on the left provides an excellent view up the gorge towards the summit of the White Pass. Some tour operators have started calling this part of the White Pass Klondike Pass, but thats just a name they created. Although the Klondike Highway runs through it, it was never used during the Klondike Gold Rush, the infamous Dead Horse Trail runs alongside the railway in the pass to the east.",i:"‚õ∞Ô∏è",lat:59.6234,lon:-135.0756},
{m:"14.4",k:"23.2",t:"White Pass Summit",x:"The summit of the White Pass at 3,292 feet in early May. The summit of the main arm of the White Pass, through which the railway runs, is 2,865 feet. It takes serious equipment to deal with the snowfalls that the Coastal Mountains get, the White Pass is in the Boundary Ranges of the Coastal Mountains. This photo of an Alaska highways department rotary snowplow was taken in early March.",i:"üóª",lat:59.6289,lon:-135.0512},
{m:"14.7",k:"23.7",t:"Welcome to Alaska",x:"Welcome to Alaska sign with large parking area on the left, it makes a superb photo stop, with the White Pass and Sawtooth Mountains in the background. Only in the very early morning and late afternoon during the summer does the sun hit the front of the sign, its most often seen backlit.",i:"üá∫üá∏",lat:59.6312,lon:-135.0489},
{m:"",k:"24.3",t:"International Border",x:"This photo shows the view south from the Alaska, British Columbia border in mid February. Mileages in this guide now switch to Km first to correspond with highway signage. The speed limit from this point north is 90 kilometers per hour, which equals 55 mph. International Border Falls on the left, with large gravel parking area known as the Feather Cleveland Pullout as this is the access to Mount Cleveland and Feather Peak to the south. A large sign describes how to assess avalanche danger.",i:"üá®üá¶",lat:59.6334,lon:-135.0467},
{m:"",k:"36.5",t:"Fraser Customs",x:"Above is the Canada Customs post at Fraser as you see it heading north. All vehicles must stop and report. The red building on the right is the last water tower remaining on the WP and YR line from the days when steam locomotives were used. There are nice washrooms with flush toilets in the water tower building, but DO NOT pull into that parking lot before clearing Customs. Note the spelling of Fraser, its commonly mis-spelled and mispronounced as Frasier like the television sitcom. Fraser is also the point where people switch from motorcoaches to WP and YR trains or vice-versa.",i:"üá®üá¶",lat:59.7234,lon:-134.8456},
{m:"",k:"47.4",t:"Yukon Suspension Bridge",x:"The Tutshi River, pronounced TOO-shy, looking north from the side of the highway, which follows the river for about 2 miles. The Tutshi River is popular with rafters and kayakers, even though access is difficult. Yukon Suspension Bridge, in 2006 this private nature history interpretive center was opened alongside the highway. It includes a suspension footbridge across the Tutshi River canyon with spectacular views, a cafe serving their famous bison chili and other items, gift shop and interpretive displays. 2020 Special Offer, by showing your copy of Murrays Guide, admission for your entire group is reduced! The usual rate is $18.00 for adults, $14 for seniors, and $9 children, and children 6 and under are free, by showing your guide, adults are $14, seniors $10 and children $6. The development cost over $3 million to construct.",i:"üåâ",lat:59.8123,lon:-134.6789},
{m:"",k:"69.8",t:"Tutshi Lake Panorama",x:"Above is a panoramic shot of Tutshi Lake, seen looking south from the large viewpoint at this point. In any weather, this is a must-stop. You have to look very hard to spot any of the handful of cabins on Tutshi Lake, and seeing a boat of any kind is rare, there is only one rustic boat launch. This photo was shot in March.",i:"üèîÔ∏è",lat:60.0234,lon:-134.4567},
{m:"",k:"80.3",t:"Welcome to Yukon",x:"Welcome to the Yukon and leaving British Columbia. The photo shows the view northbound in May. Watch for both Dall sheep and mountain goats on Dail Peak to the left, seeing up to 20 animals at a time is not uncommon. The best photo ops here are in the afternoon, as fewer people stop then, and the sun hits the front of the sign, exactly when depends on the date. From Monday through Friday in the summer, Jacqueline St. Jacques, Yukon Rustic Jewelry, sells her handcrafted stone-and-wire jewelry here. As you pull away from the Welcome to the Yukon sign, see if you can spot the British Columbia, Yukon border slash running diagonally up the very steep slopes on the far side of the lake, its quite obvious early in the summer, less so as the season progresses. The border was surveyed and marked in 1899 to 1900 because of mineral exploration being conducted, any mines developed on the British Columbia side paid royalties to the province, on the Yukon side the royalties went to the federal government.",i:"üêë",lat:60.1123,lon:-134.3234},
{m:"",k:"105.6",t:"Carcross",x:"Turn left to reach downtown Carcross, which has 422 residents as of the September 2013 report. This is one of the oldest communities in the Yukon, first settled during the rush to the Klondike. On July 29, 1900, a Golden Spike was driven at the north end of the railway bridge to celebrate completion of the railway. Carcross became a major transportation hub during the 1920s, with significant railway, sternwheeler and aircraft traffic serving the southern Yukon and northern British Columbia. A historical walking tour brochure can be picked up for free at the Visitor Reception Centre. The 2-mile-long fine sand beach at Carcross provides a great place for a walk or picnic. There is a viewing deck and outhouses at the north end of the main part of the beach, a half-mile to the right as you face the lake. Downtown Carcross has recently undergone a major redevelopment, with the historic Caribou Hotel being restored privately, a $900,000 footbridge across the Nares River built by the federal and Territorial governments, lots of paving, a commercial complex and several other smaller projects. Visitor services in downtown Carcross: a Visitor Reception Centre in the very colourful retail village on the left. Also in the retail village, Caribou Crossing Coffee with sandwiches, pastries coffee, both drip and specialty, a large bistro with beer and burgers, and many other small shops. Public washrooms in the dark red building with the Carcross sign, on the left as you drive in to town. Matthew Watsons General Store, famous for its ice cream. Tanya Kennedys custom jewellery shop, a metalwork-art shop. The post office gets 3 mail deliveries per week. The library has a computer available for Internet access, at no charge.",i:"üèòÔ∏è",lat:60.1745,lon:-134.7012},
{m:"",k:"107.7",t:"Carcross Desert",x:"Viewing area and access to the Carcross dunes system, with this part of it commonly called The Worlds Smallest Desert. The dune system is home to several rare plants including Baikal sedge, Carex sabulosa, and Yukon lupine, Lupinus kuschei. Outhouses and interpretive signs are found here. A hike to the top of the dunes gives both expansive views across the valley to Lake Bennett and the glacier-studded peaks along the lakes West Arm, and a look at how active the dune system is, as its burying the forest to the east.",i:"üèúÔ∏è",lat:60.1823,lon:-134.6834},
{m:"",k:"117.6",t:"Emerald Lake",x:"The main Emerald Lake viewing area. The panorama on the next page shows you why this is the most-photographed lake in the Yukon. As well as the large pullout above the lake, there is parking in the forest at the south end of the lake. There are no picnic tables or other visitor services at the lake. The large home above the lake, on 6 acres, sold in late 2011 for $519,000, in contrast to the situation in so many areas, property prices in all areas of the Yukon have jumped dramatically in recent years. This view of Spirit Lake and Montana Mountain was taken from the rocky ridge above Emerald Lake, a steep but short hike from the parking lot. The scenery past Emerald Lake greatly decreases in drama from what has been seen to this point, and Emerald Lake is the usual turn-around point for day trips out of Skagway, both for individuals and tour operators. Whitehorse, the capital city of the Yukon Territory, is 39 miles further north, thats to the downtown core. It has a population of 27,190 as of December 2011, with full services and a wide range of attractions, natural, historic and cultural. Depending on your specific interests it may be worth visiting on a day trip out of Skagway but for most people I suggest that there is plenty to do without driving that far.",i:"üíö",lat:60.2456,lon:-134.5678},
{m:"",k:"157.7",t:"Alaska Highway Junction",x:"The Alaska Highway, at Kilometer 1,404.4 from its start at Dawson Creek, British Columbia. This intersection is known locally at the Carcross Corner. The city limits of Whitehorse are 0.8 kilometers to the left, the city center about 22 kilometers. Straight ahead, on the opposite side of the Alaska Highway, The Cut Off Restaurant offers lunch and dinner in a unique atmosphere. Opened in 2016, the premises is well stocked with all manner of artifacts from the early days of the Yukon, and of the Alaska Highway in particular. I hope that youve enjoyed this journey on the South Klondike Highway with me. If you have any comments or questions about travel in the North, youre welcome to email me at YukonAlaska@gmail.com",i:"üõ£Ô∏è",lat:60.7067,lon:-135.0568}
];

var g=null,h='',j=0,p=false,q=false,r=0.9,s=0,t=0,u=null,v=null;
var gpsEnabled=false,watchId=null,currentLat=null,currentLon=null;
var availableVoices=[],selectedVoice=null;

// Load voices
function loadVoices(){
    availableVoices=window.speechSynthesis.getVoices();
    
    // Filter to only English voices (US and GB)
    var englishVoices=availableVoices.filter(function(voice){
        return voice.lang==='en-US'||voice.lang==='en-GB'||
               voice.lang.startsWith('en-US')||voice.lang.startsWith('en-GB');
    });
    
    if(englishVoices.length===0){
        // Fallback to any English voice if en-US/en-GB not found
        englishVoices=availableVoices.filter(function(voice){
            return voice.lang.startsWith('en');
        });
    }
    
    // Only keep quality voices (Enhanced, Premium, or with specific keywords)
    var qualityVoices=englishVoices.filter(function(voice){
        var name=voice.name.toLowerCase();
        return name.includes('enhanced') || name.includes('premium') || 
               name.includes('samantha') || name.includes('alex') || 
               name.includes('karen') || name.includes('daniel') ||
               name.includes('natural') || name.includes('neural') ||
               name.includes('compact');
    });
    
    var select=document.getElementById('voiceSelect');
    select.innerHTML='';
    
    // Show quality voices first, then all English voices
    var voicesToShow=qualityVoices.length>0?qualityVoices:englishVoices;
    
    // Add quality voices
    if(qualityVoices.length>0){
        var optgroup=document.createElement('optgroup');
        optgroup.label='Premium Voices';
        qualityVoices.forEach(function(voice){
            var opt=document.createElement('option');
            opt.value=availableVoices.indexOf(voice);
            opt.textContent=voice.name+' ('+voice.lang+')';
            opt.dataset.voiceName=voice.name;
            optgroup.appendChild(opt);
        });
        select.appendChild(optgroup);
    }
    
    // Add other English voices
    var otherVoices=englishVoices.filter(function(v){return !qualityVoices.includes(v);});
    if(otherVoices.length>0){
        var optgroup2=document.createElement('optgroup');
        optgroup2.label='Standard Voices';
        otherVoices.forEach(function(voice){
            var opt=document.createElement('option');
            opt.value=availableVoices.indexOf(voice);
            opt.textContent=voice.name+' ('+voice.lang+')';
            opt.dataset.voiceName=voice.name;
            optgroup2.appendChild(opt);
        });
        select.appendChild(optgroup2);
    }
    
    // Try to select a good default voice
    var defaultVoice=qualityVoices.find(function(v){
        return v.name.toLowerCase().includes('samantha') || v.name.toLowerCase().includes('enhanced');
    });
    
    if(!defaultVoice&&voicesToShow.length>0){
        defaultVoice=voicesToShow[0];
    }
    
    if(defaultVoice){
        selectedVoice=defaultVoice;
        select.value=availableVoices.indexOf(defaultVoice);
        document.getElementById('voiceName').textContent=defaultVoice.name.split(' ')[0];
    }
}

// Initialize voices
if(speechSynthesis.onvoiceschanged!==undefined){
    speechSynthesis.onvoiceschanged=loadVoices;
}
loadVoices();

// Calculate distance between two coordinates (Haversine formula)
function calculateDistance(lat1,lon1,lat2,lon2){
    var R=6371; // Earth radius in km
    var dLat=(lat2-lat1)*Math.PI/180;
    var dLon=(lon2-lon1)*Math.PI/180;
    var a=Math.sin(dLat/2)*Math.sin(dLat/2)+
           Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
           Math.sin(dLon/2)*Math.sin(dLon/2);
    var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
    return R*c;
}

function updateDistances(){
    if(!currentLat||!currentLon)return;
    
    var nearest=null;
    var nearestDist=999999;
    
    mileData.forEach(function(mile,idx){
        if(!mile.lat||!mile.lon)return;
        var dist=calculateDistance(currentLat,currentLon,mile.lat,mile.lon);
        mile.distance=dist;
        
        if(dist<nearestDist){
            nearestDist=dist;
            nearest=idx;
        }
    });
    
    renderMileList();
    
    // Scroll to nearest
    if(nearest!==null){
        var nearestEl=document.querySelector('[data-index="'+nearest+'"]');
        if(nearestEl){
            nearestEl.scrollIntoView({behavior:'smooth',block:'center'});
        }
    }
}

function toggleGPS(){
    if(!navigator.geolocation){
        document.getElementById('gpsStatus').textContent='GPS not supported on this device';
        return;
    }
    
    if(gpsEnabled){
        // Disable GPS
        if(watchId!==null){
            navigator.geolocation.clearWatch(watchId);
            watchId=null;
        }
        gpsEnabled=false;
        currentLat=null;
        currentLon=null;
        document.getElementById('gpsBtn').classList.remove('active');
        document.getElementById('gpsText').textContent='Enable GPS Location';
        document.getElementById('gpsStatus').innerHTML='';
        renderMileList();
    }else{
        // Enable GPS
        document.getElementById('gpsBtn').classList.add('disabled');
        document.getElementById('gpsText').textContent='Getting location...';
        document.getElementById('gpsStatus').textContent='Requesting GPS permission...';
        
        watchId=navigator.geolocation.watchPosition(
            function(position){
                currentLat=position.coords.latitude;
                currentLon=position.coords.longitude;
                gpsEnabled=true;
                document.getElementById('gpsBtn').classList.remove('disabled');
                document.getElementById('gpsBtn').classList.add('active');
                document.getElementById('gpsText').textContent='GPS Tracking Active';
                document.getElementById('gpsStatus').innerHTML='<div class="location-info">üìç Lat: '+currentLat.toFixed(4)+', Lon: '+currentLon.toFixed(4)+'</div>';
                updateDistances();
            },
            function(error){
                document.getElementById('gpsBtn').classList.remove('disabled');
                document.getElementById('gpsStatus').textContent='GPS error: '+error.message;
            },
            {enableHighAccuracy:true,maximumAge:10000,timeout:5000}
        );
    }
}

function renderMileList(){
    var list=document.getElementById('mileList');
    list.innerHTML=mileData.map(function(item,idx){
        var distBadge='';
        var classes='mile-item';
        
        if(item.distance!==undefined){
            var distKm=item.distance;
            var distMi=distKm*0.621371;
            var distText=distKm<1?Math.round(distKm*1000)+'m':distKm.toFixed(1)+'km';
            
            if(distKm<0.5){
                classes+=' nearest';
                distBadge='<div class="distance-badge nearest">üìç '+distText+'</div>';
            }else if(distKm<5){
                classes+=' nearby';
                distBadge='<div class="distance-badge nearby">'+distText+'</div>';
            }else if(distKm<20){
                distBadge='<div class="distance-badge">'+distText+'</div>';
            }
        }
        
        return'<div class="'+classes+'" data-index="'+idx+'">'+distBadge+'<div class="mile-icon">'+item.i+'</div><div class="mile-content"><div class="mile-header"><span class="mile-badge">'+(item.m?'Mile '+item.m:'Km '+item.k)+'</span><span class="mile-km">'+(item.m?'('+item.k+' km)':'')+'</span></div><div class="mile-title">'+item.t+'</div><div class="mile-text">'+item.x+'</div></div><div class="mile-play"><svg class="play-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div></div>'
    }).join('');
}

function setupEventListeners(){
    document.getElementById('gpsBtn').addEventListener('click',toggleGPS);
    
    document.querySelectorAll('.mile-item').forEach(function(item){
        item.addEventListener('click',function(){
            var idx=parseInt(this.dataset.index);
            var mile=mileData[idx];
            z(mile.x,idx,mile.t,mile.m||'Km '+mile.k);
        });
    });
    
    document.getElementById('pauseBtn').addEventListener('click',A);
    document.getElementById('stopBtn').addEventListener('click',B);
    document.getElementById('skipBackBtn').addEventListener('click',C);
    document.getElementById('skipForwardBtn').addEventListener('click',D);
    
    document.getElementById('voiceBtn').addEventListener('click',function(){
        document.getElementById('voiceSelector').classList.toggle('active');
    });
    
    document.getElementById('voiceSelect').addEventListener('change',function(){
        var idx=parseInt(this.value);
        selectedVoice=availableVoices[idx];
        var shortName=selectedVoice.name.split(' ')[0];
        document.getElementById('voiceName').textContent=shortName;
        if(p&&!q){
            E(h,j,true);
        }
    });
    
    document.getElementById('speedBtn').addEventListener('click',function(){
        document.getElementById('speedSlider').classList.toggle('active');
    });
    
    document.getElementById('speedRange').addEventListener('input',function(){
        r=parseFloat(this.value);
        document.getElementById('speedValue').textContent=r.toFixed(1);
        if(p&&!q){
            E(h,j,true);
        }
    });
}

function z(a,b,c,d){
    if(g===b&&(p||q)){
        A();
        return;
    }
    h=a;
    g=b;
    j=0;
    t=0;
    document.getElementById('nowPlayingTitle').textContent=c;
    document.getElementById('nowPlayingMile').textContent=d;
    F();
    E(a,0,false);
}

function E(a,b,c){
    window.speechSynthesis.cancel();
    if(u)clearInterval(u);
    
    var textToSpeak=a.substring(b);
    var totalLength=a.length;
    
    if(textToSpeak.trim().length===0){
        B();
        return;
    }
    
    var estimatedDurationMs=(textToSpeak.length/5/150)*60000/r;
    v=new SpeechSynthesisUtterance(textToSpeak);
    v.rate=r;
    v.pitch=1;
    v.volume=1;
    
    if(selectedVoice){
        v.voice=selectedVoice;
    }
    
    var initialProgress=c?t:(b/totalLength)*100;
    s=initialProgress;
    G();
    
    var startTime=Date.now();
    u=setInterval(function(){
        var elapsed=Date.now()-startTime;
        var progressPercent=initialProgress+(elapsed/estimatedDurationMs*(100-initialProgress));
        if(progressPercent>=100){
            s=100;
            G();
            if(u)clearInterval(u);
        }else{
            s=Math.min(progressPercent,99);
            G();
        }
    },50);
    
    v.onstart=function(){
        p=true;
        q=false;
        document.getElementById('controls').classList.add('active');
        H();
    };
    
    v.onend=function(){
        p=false;
        q=false;
        g=null;
        j=0;
        s=100;
        G();
        setTimeout(function(){
            s=0;
            t=0;
            G();
            document.getElementById('controls').classList.remove('active');
            F();
        },500);
        if(u)clearInterval(u);
    };
    
    v.onerror=function(){
        if(u)clearInterval(u);
    };
    
    v.onboundary=function(event){
        if(event.name==='word'&&event.charIndex!==undefined){
            j=b+event.charIndex;
        }
    };
    
    window.speechSynthesis.speak(v);
}

function A(){
    if(!h||g===null)return;
    if(q){
        E(h,j,true);
    }else{
        t=s;
        window.speechSynthesis.cancel();
        if(u)clearInterval(u);
        q=true;
        p=false;
        H();
    }
}

function B(){
    window.speechSynthesis.cancel();
    if(u)clearInterval(u);
    p=false;
    q=false;
    g=null;
    j=0;
    s=0;
    t=0;
    G();
    document.getElementById('controls').classList.remove('active');
    F();
}

function C(){
    if(!h)return;
    var newPosition=Math.max(0,j-50);
    j=newPosition;
    t=Math.max(0,s-10);
    E(h,newPosition,true);
}

function D(){
    if(!h)return;
    var newPosition=Math.min(h.length-1,j+50);
    j=newPosition;
    t=Math.min(100,s+10);
    E(h,newPosition,true);
}

function G(){
    document.getElementById('progressFill').style.width=s+'%';
    document.getElementById('progressPercent').textContent=Math.round(s)+'%';
    document.getElementById('progressStatus').textContent=q?'‚è∏ Paused':'‚ñ∂ Playing';
}

function H(){
    var pauseBtn=document.getElementById('pauseBtn');
    if(q){
        pauseBtn.innerHTML='<svg fill="none" stroke="white" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
        pauseBtn.title="Resume";
    }else{
        pauseBtn.innerHTML='<svg fill="none" stroke="white" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"/></svg>';
        pauseBtn.title="Pause";
    }
}

function F(){
    document.querySelectorAll('.mile-item').forEach(function(item,idx){
        if(idx===g&&(p||q)){
            item.classList.add('active');
            var playContainer=item.querySelector('.mile-play');
            if(q){
                playContainer.innerHTML='<div class="play-indicator"><svg fill="none" stroke="white" viewBox="0 0 24 24" style="width: 20px; height: 20px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"/></svg></div>';
            }else{
                playContainer.innerHTML='<div class="play-indicator"><div class="pulse"></div></div>';
            }
        }else{
            item.classList.remove('active');
            var playContainer=item.querySelector('.mile-play');
            playContainer.innerHTML='<svg class="play-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
        }
    });
}

renderMileList();
setupEventListeners();

var lastTouchEnd=0;
document.addEventListener('touchend',function(event){
    var now=Date.now();
    if(now-lastTouchEnd<=300){
        event.preventDefault();
    }
    lastTouchEnd=now;
},false);
    </script>
</body>
</html>